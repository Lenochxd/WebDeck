<html>
  <head>
    {% if is_exe == True %}
      <title>WebDeck</title>
    {% else %}
      <title>WebDeck DEV</title>
    {% endif %}
    <link rel="stylesheet" href="static/themes/{{config['front']['theme']}}">
    <link rel="stylesheet" href="static/files/loading-squares.css">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <link rel="icon" href="static\files\icon.ico"/>
    <meta charset="UTF-8">


    <style>
      label, input { display:block; }
      input.text { margin-bottom:12px; width:95%; padding: .4em; }
      fieldset { padding:0; border:0; margin-top:25px; }
      h1 { font-size: 1.2em; margin: .6em 0; }
      div#users-contain { width: 350px; margin: 20px 0; }
      div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
      div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
      .ui-dialog .ui-state-error { padding: .3em; }
      .validateTips { border: 1px solid transparent; padding: 0.3em; }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="/static/files/names-color-setting.js"></script>
    <script src="/static/files/background-setting.js"></script>
    <script src="/static/files/filepath.js"></script>
    <script src="/static/files/loadingscreen.js"></script>
    <script src="/static/files/upload_file.js"></script>
    {# <script src="/static/files/buttonclick.js"></script> #}

    {% set black_theme = '' %}
    {% if config['front']['black-theme'] == 'true' %}
      {% set black_theme = ' black-theme' %}
    {% endif %}

    {# {% set total_boxes = int(config["front"]["width"]) * int(config["front"]["height"]) %}
    {% for folder_id, value in config["front"]["buttons"].items() %}


      {% for _ in range(total_boxes) %}
        {% if config["front"]["buttons"][folder_id]|length < total_boxes %}
          {% set config = config["front"]["buttons"][folder_id].append({"VOID": "VOID"}) %}
    
        {% endif %}
      {% endfor %}
      
    
    {% endfor %} #}

  </head>
  <body>
    <div id="loading-screen">
      {# <p>Chargement...</p> #}
      <div class="loadingspinner">
        <div id="square1"></div>
        <div id="square2"></div>
        <div id="square3"></div>
        <div id="square4"></div>
        <div id="square5"></div>
      </div>
    </div>


    {% if config["settings"]["show-console"].lower() == "true" %}
      <form class="form">
        <label style="color: white;">Console:</label><br>
        <input type="text" class="message {{black_theme}}"><br>
        <button type="submit">Submit</button>
      </form>
    {% endif %}

    <style>
      
      {% if random_bg and not random_bg.strip() == "" %}
        body, div.fakeform-container {
          {% if '**uploaded/' in random_bg.lower() %}
            background-image: url("{{ "static/files/uploaded/" + random_bg.replace('**uploaded/', '') }}")!important;
            background-size: cover;
            background-color: transparent;
          {% else %}
            background-color: {{random_bg}}!important;
            background-image: none;
          {% endif %}
        }
        div.fakeform-container {
          background-size: 500%;
        }
      {% endif %}
      
      {% for folder_id, value in config["front"]["buttons"].items() %}
        {% for button_config in config["front"]["buttons"][folder_id] %}
          {% if 'background-color' in button_config.keys() %}
            @keyframes animation-{{ button_config['background-color'].replace('#','') }} {
              100% {background-color: #{{ button_config['background-color'].replace('#','') }};}
              100% {background-color: none;}
            }
            .button-{{ button_config['background-color'].replace('#','') }}, .button-{{ button_config['background-color'].replace('#','') }}:focus {
              background-color: #{{ button_config['background-color'].replace('#','') }};
              box-shadow: #{{ button_config['background-color'].replace('#','') }} 0 1px 3px 0;
              color: rgba(0, 0, 0, 0.85);
            }
            .button-{{ button_config['background-color'].replace('#','') }}:hover {
              transform: translateY(-1px);
              animation-name: animation-{{ button_config['background-color'].replace('#','') }};
              animation-duration: 1s;
            } 
            .button-{{ button_config['background-color'].replace('#','') }}:active {
              background-color: #{{ button_config['background-color'].replace('#','') }};
              border-color: rgba(0, 0, 0, 0.15);
              box-shadow: rgba(0, 0, 0, 0.06) 0 2px 4px;
              color: rgba(0, 0, 0, 0.65);
              transform: translateY(0);
            }
          {% endif %}
        {% endfor %}
      {% endfor %}
    </style>

    <div id="EditorButtons-Folders" style="color: white; display: none; position: fixed; top: 0; left: 0;">
      Open folder: 
      {% for folder_id, value in config["front"]["buttons"].items() %}
        <button class="button EditorButtons-Folder" onclick="folder_{{ folder_id }}()">
          {{ folder_id }}
        </button>
      {% endfor %}
    </div>

    {% for folder_id, value in config["front"]["buttons"].items() %}
      <div id="folder-{{ folder_id }}" class="buttons-center">
        <div id="folder-{{ folder_id }}" class="all-buttons">
          {% set edit_modal_ID1 = loop.index0 %}
          {% for button_config in config["front"]["buttons"][folder_id] %}
            {% set edit_modal_ID = "e" + str(edit_modal_ID1) + "X" + str(loop.index0) %}
            {% set button_id = loop.index0 %}
            {% set onclick = 'type=submit' %}

            {% if 'VOID' in button_config %}
              <div class="void form-{{ button_id }}" id="{{edit_modal_ID}}">
                <div class="checkbox" style="display: none;"></div>
                <div class="add-button" add_FOLDER="{{ folder_id }}" add_ID="{{ button_id }}" style="display: none; top: 40.3675;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                    <path d="M12 4v16m8-8H4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
            {% else %}
            
              <form class="form-{{ button_id }} form" id="{{edit_modal_ID}}">
                <div class="container-editmode">
                  <div class="edit-button" style="display: none;" edit_modal_ID="{{ edit_modal_ID }}">
                    <svg width="16px" height="16px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="Edit / Edit_Pencil_01">
                      <path id="Vector" d="M12 8.00012L4 16.0001V20.0001L8 20.0001L16 12.0001M12 8.00012L14.8686 5.13146L14.8704 5.12976C15.2652 4.73488 15.463 4.53709 15.691 4.46301C15.8919 4.39775 16.1082 4.39775 16.3091 4.46301C16.5369 4.53704 16.7345 4.7346 17.1288 5.12892L18.8686 6.86872C19.2646 7.26474 19.4627 7.46284 19.5369 7.69117C19.6022 7.89201 19.6021 8.10835 19.5369 8.3092C19.4628 8.53736 19.265 8.73516 18.8695 9.13061L18.8686 9.13146L16 12.0001M12 8.00012L16 12.0001" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g>
                    </svg>
                  </div>
                  <div class="delete-button" style="display: none;">
                    <svg fill="#000000" width="16px" height="16px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18.8,16l5.5-5.5c0.8-0.8,0.8-2,0-2.8l0,0C24,7.3,23.5,7,23,7c-0.5,0-1,0.2-1.4,0.6L16,13.2l-5.5-5.5  c-0.8-0.8-2.1-0.8-2.8,0C7.3,8,7,8.5,7,9.1s0.2,1,0.6,1.4l5.5,5.5l-5.5,5.5C7.3,21.9,7,22.4,7,23c0,0.5,0.2,1,0.6,1.4  C8,24.8,8.5,25,9,25c0.5,0,1-0.2,1.4-0.6l5.5-5.5l5.5,5.5c0.8,0.8,2.1,0.8,2.8,0c0.8-0.8,0.8-2.1,0-2.8L18.8,16z"/>
                    </svg>
                  </div>
                </div>

                
                <input type="hidden" class="message {{black_theme}}" value="{{ button_config['message'] }}">
                <div class="checkbox" style="display: none;"></div>
                
                {% set class = "wd_button" %}
                {% if 'background-color' in config["front"]["buttons"][folder_id][button_id].keys() %}
                  {% set class = class + ' button-'+button_config['background-color'].replace('#','') %}
                {% endif %}

                {% if config["front"]["buttons"][folder_id][button_id]["message"] %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/fullscreen' %}
                    {% set class = class + " fullscreen-btn" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/zoom in' %}
                    {% set class = class + " zoom-in-btn" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/zoom out' %}
                    {% set class = class + " zoom-out-btn" %}
                    {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/buttons-div expand' %}
                    {% set class = class + " expand-btn" %}
                    {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/buttons-div shrink' %}
                    {% set class = class + " shrink-btn" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/box-zoom-out' %}
                    {% set class = class + " box-zoom-out" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/box-zoom-in' %}
                    {% set class = class + " box-zoom-in" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/page-dezoom' %}
                    {% set class = class + " dezoom-btn" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/page-zoom' %}
                    {% set class = class + " zoom-btn" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/open-modal' %}
                    {% set class = class + " open-config-modal" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/open-config' %}
                    {% set class = class + " open-config-modal" %}
                  {% endif %}
                  {% if config["front"]["buttons"][folder_id][button_id]["message"].strip() == '/open-config-modal' %}
                    {% set class = class + " open-config-modal" %}
                  {% endif %}
                {% endif %}

                {% if button_config["message"] and button_config["message"].startswith("/folder") %}
                  {% set onclick = 'onclick="' + 'folder_' + button_config['message'].replace('/folder ', '') + '()" onclickhandler="' + 'folder_' + button_config['message'].replace('/folder ', '') + '()"' %}
                  <div class="swapMode-open-folder" {{ onclick }} style="display: none;">
                    Open Folder
                  </div>
                {% endif %}

                {% set fill = '' %}
                  {% if 'color' in config["front"]["buttons"][folder_id][button_id].keys() %}
                    {% if config["front"]["buttons"][folder_id][button_id]["color"] == 'invert' %}
                      {% set fill = 'filter: invert(1)' %}
                    {% else %}
                      {% set fill = 'fill:'+ config["front"]["buttons"][folder_id][button_id]["color"] +';'+' color:'+ config["front"]["buttons"][folder_id][button_id]["color"] +';' %}
                    {% endif %}
                  {% endif %}
                {% if config["front"]["buttons"][folder_id][button_id]["image"] == "" or not config["front"]["buttons"][folder_id][button_id]["image"] %}
                
                  <button {{ onclick }} id="button_{{edit_modal_ID}}" edit_modal_ID="{{ edit_modal_ID }}" class="{{class}}" role="button" style="overflow: hidden; overflow-y: hidden; max-height: 89.6px;">
                    <!--|||||||||||||||||||||||-->
                    {% if button_config['message'].startswith('/usage') %}
                      {% set name = button_config['message'].replace("'",'"',2).split('"')[1] %}
                      {% set path = button_config['message'].replace("'",'"',2).split('"')[2] %}
                      {% if button_config['message'].split()[1] %}
                        <div class="usage">
                          <div class="usage-title {{ path.replace("'",'"').replace('"]["','.').replace('"]','').replace('["','.') }}" style="{{fill}}">
                            {{ name }}
                          </div>
                          {% set usage_value = '-' %}
                          <div class="usage-value {{ path.replace("'",'"').replace('"]["','.').replace('"]','').replace('["','.') }}" style="{{fill}}">
                            {{ usage_value }}
                          </div>
                        </div>
                      {% endif %}
                    {% endif %}
                    <!--|||||||||||||||||||||||-->
                  </button>
                {% else %}
                  {% if config["front"]["buttons"][folder_id][button_id]["image"].startswith('http') %}
                    {% set imagelink = config["front"]["buttons"][folder_id][button_id]["image"] %}
                  {% elif ':' in config["front"]["buttons"][folder_id][button_id]["image"] %}
                    {% set imagelink = "static/files/images/" + config["front"]["buttons"][folder_id][button_id]["image"].split('\\')[-1] %}
                  {% elif config["front"]["buttons"][folder_id][button_id]["image"].startswith('**uploaded/') %}
                    {% set imagelink = "static/files/uploaded/" + config["front"]["buttons"][folder_id][button_id]["image"].replace('**uploaded/','') %}
                  {% else %}
                    {% set imagelink = "static/files/images/" + config["front"]["buttons"][folder_id][button_id]["image"] %}
                  {% endif %}
                  
                  <button {{ onclick }} id="button_{{edit_modal_ID}}" edit_modal_ID="{{ edit_modal_ID }}" class="{{class}}" role="button" style="overflow: hidden; overflow-y: hidden; max-height: 89.6px;">
                      {% if isfile(imagelink) %}
                        {% if imagelink.endswith('.svg') %}
                          {{ open(imagelink).read().replace('<svg ','<svg style="width:' + str(112*(int(config["front"]["buttons"][folder_id][button_id]["image_size"].replace("%", "")) /100) + 3) + 'px; height:'  + str(112*(int(config["front"]["buttons"][folder_id][button_id]["image_size"].replace("%", "")) /100) + 3) + '; ' + fill + '" ') }}
                        {% else %}
                          <img src="{{ imagelink }}" draggable="false" alt="{{ imagelink }}" style="
                            width: {{ 112 * (int(config["front"]["buttons"][folder_id][button_id]["image_size"].replace("%", "")) / 100) + 3 }}px;
                            {{fill}}"
                          >
                        {% endif %}
                      {% endif %}
                    
                    <!--|||||||||||||||||||||||-->
                    {% if button_config["message"] and button_config['message'].startswith('/usage') %}
                      {% set name = button_config['message'].replace("'",'"',2).split('"')[1] %}
                      {% set path = button_config['message'].replace("'",'"',2).split('"')[2] %}
                      {% if button_config['message'].split()[1] %}
                        <div class="usage">
                          <div class="usage-title {{ path.replace("'",'"').replace('"]["','.').replace('"]','').replace('["','.') }}" style="{{fill}}">
                            {{ name }}
                          </div>
                          {% set usage_value = "-" %}
                          <div class="usage-value {{ path.replace("'",'"').replace('"]["','.').replace('"]','').replace('["','.') }}" style="{{fill}}">
                            {{ usage_value }}
                          </div>
                        </div>
                      {% endif %}
                    {% endif %}
                    <!--|||||||||||||||||||||||-->
                  </button>
                {% endif %}
                {% if config["front"]["show-names"].lower() == "true" %}
                  {% set buttontext_style = ''%}
                  {% if config["front"]["names-color"] and not config["front"]["names-color"].strip() == "" %}
                    {% set buttontext_style = 'style="color:'+config["front"]["names-color"]+';"'%}
                  {% endif %}
                  <p class="buttontext" {{buttontext_style}}>
                    {{ button_config['name'] }}
                  </p>
                {% endif %}
                
              </form>

              {% if button_config["message"] %}
                {% set button_command = config["front"]["buttons"][folder_id][button_id]["message"].strip() %}
              {% else %}
                {% set button_command = '' %}
              {% endif %}
              {% set button_settings = config["front"]["buttons"][folder_id][button_id] %}

              {% for category, commands_name in commands.items() if command_value == None %}
                {% for command_name_, command in commands_name.items() if command_value == None %}
                  {% if command['command'] %}
                    {% if button_command.lower().split()[0].strip() == command['command'].lower().strip() %}
                      {% set command_name = command_name_ %}
                      {% set command_value = command %}
                      {% include 'editbutton_modal.jinja' %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
              {% endfor %}

              {% if command_value is not defined %}
                {% set command_value = button_settings %}
                {% include 'editbutton_modal.jinja' %}
              {% endif %}
            
              
            {% endif %}
          {% endfor %}
        </div>
      </div>
    {% endfor %}


    <div id="EditorButtons" style="display: none;">
      <button class="button" id="SaveExitEditorButton">
        <img src="static/files/images/save.svg" width="20" height="20" id="EditorButtonLogo"> <!-- https://feathericons.com/?query=save -->
        [E] Save and exit
      </button>
      <button class="button" id="exitEditorButton">[Q] Quit without saving</button>
      
      <button class="button" id="swapEditorButton">
        <img src="static/files/images/swap.png" width="20" height="20" id="EditorButtonLogo">
        [S] Swap 2 Buttons
      </button>
    </div>


    <div class="modal-container {{black_theme}}" id="modal-container">
      <div class="modal-content {{black_theme}}">

        <div class="modal-header bold">
          <h1 class="config-modal">Configuration</h1>
          <div class="modal-close">
            <svg class="config-modal {{black_theme}}" xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
              <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
            </svg>
          </div>
        </div>
        <a class="{{black_theme}}" id="version" href="https://github.com/LeLenoch/WebDeck/releases/tag/v{{versions['versions'][0]['version']}}" target="_blank" title="See patchnotes" alt="See patchnotes">
          v{{versions['versions'][0]['version']}}
        </a>

        <div class="modal-main">
          <div class="config-container choose-background {{black_theme}}" id="choose-background" style="display: none;">
            <
            <button type="button" id="setting-background-back" class="{{black_theme}}">
              Back
            </button>
            <h1 class="config-title">Random backgrounds list</h1>
            <div class="background-color-input-container">
              <input type="color" class="background-color-input {{black_theme}}" id="background-color-input">
              <input type="text" id="background-color-hex" class="background-color-setting {{black_theme}}" placeholder="Background Color (HEX)">
            </div>

            <div id="create-bg-choices">
              <button class="{{black_theme}}" id="create-color-bg">Add a color backgroud</button>
              or
              <input type="file" id="create-image-bg" class="{{black_theme}}" accept="image/jpeg, image/png, image/gif">
            </div>
            
            <div class="editorStyle-bar {{black_theme}}"></div>

            <div id="choose-backgrounds-container">

              {% for bg in config["front"]["background"] %}
                {% if bg.replace('//','').startswith('rgb(') or bg.replace('//','').startswith('#') %}
                  <div class="choose-bg-element choose-bg-element-color choose-bg-element-pageload {{black_theme}}" background="{{bg}}" style="background-color: {{bg.replace('//','')}};">
                    Background color : {{bg.replace('//','')}}
                    <div class="choose-bg-buttons">

                      {% if bg.startswith('//') %}
                        <div class="choose-bg-activate-button"></div>
                      {% else %}
                        <div class="choose-bg-activate-button choose-bg-activate-button-checked"></div>
                      {% endif %}

                      <svg class="choose-bg-delete-button" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                        <title>Remove this background</title>
                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"></path>
                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"></path>
                      </svg>
                    </div>
                  </div>
                {% else %}
                  <div class="choose-bg-element choose-bg-element-image {{black_theme}}" background="{{bg.replace('//','')}}">
                    <div class="choose-bg-pseudo-element" style="background-image: url({{ "static/files/uploaded/" + bg.replace('//','').replace('**uploaded/', '') }})"></div>
                    <img src="{{ 'static/files/uploaded/' + bg.replace('//','').replace('**uploaded/', '') }}">
                    <div class="choose-bg-buttons">
                      {% if bg.startswith('//') %}
                        <div class="choose-bg-activate-button"></div>
                      {% else %}
                        <div class="choose-bg-activate-button choose-bg-activate-button-checked"></div>
                      {% endif %}
                    
                      <svg class="choose-bg-delete-button" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                        <title>Remove this background</title>
                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"></path>
                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"></path>
                      </svg>
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>

          </div>



          <div class="config-container {{black_theme}}" id="config-container" style="display: block;">

            <button class="button modal-button" id="editorButton">[Q] Enter editor mode</button>

            <form id="config-form" class="config-form">
              <div class="setting-category settings black-theme">
                <h1 class="config-title">Settings</h1>

                {% if is_exe == True %}
                  <div class="setting windows-startup">
                    <p>Start on Windows startup</p>
                    <label for="windows-startup" class="switch">
                      {% if 'windows-startup' in config['settings'].keys() %}
                        <input class="{{black_theme}}" type="checkbox" id="windows-startup" name="settings.windows-startup" {% if config['settings']['windows-startup'].lower() == 'true'%}checked{% endif %}>
                      {% else %}
                        <input class="{{black_theme}}" type="checkbox" id="windows-startup" name="settings.windows-startup" checked>
                      {% endif %}
                      <span class="slider round"></span>
                    </label>
                  </div>

                  <div class="setting auto-updates">
                    <p>Auto updates</p>
                    <label for="auto-updates" class="switch">
                      {% if 'auto-updates' in config['settings'].keys() %}
                        <input class="{{black_theme}}" type="checkbox" id="auto-updates" name="settings.auto-updates" {% if config['settings']['auto-updates'].lower() == 'true'%}checked{% endif %}>
                      {% else %}
                        <input class="{{black_theme}}" type="checkbox" id="auto-updates" name="settings.auto-updates" checked>
                      {% endif %}
                      <span class="slider round"></span>
                    </label>
                  </div>
                {% endif %}

                {# <div class="setting language">
                  <label for="language">Language</label>
                  <input class="{{black_theme}}" type="text" id="language" name="settings.language" {% if not config['settings']['language'].strip() == ''%}value="{{config['settings']['language']}}"{% endif %}>  
                </div> #}
                <div class="setting language">
                  <label for="language">Language</label>
                  <select id="language" name="settings.language">
                    {% for lang in langs %}
                      <option value="{{lang}}" {% if config['settings']['language'].lower() == lang.lower() %}selected{% endif %}>{{lang}}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="setting spotify-api">
                  <div class="settings-title-info">
                    <label for="spotify" style="margin-top: 3;">Spotify API</label>
                    {% set spotify_info = "https://github.com/LeLenoch/WebDeck/blob/master/static/files/FAQ-en.md#how-to-connect-your-spotify-account" %}
                    {% if config.settings.language == "fr" %}
                      {% set spotify_info = "https://github.com/LeLenoch/WebDeck/blob/master/static/files/FAQ-fr.md#comment-connecter-mon-compte-spotify-" %}
                    {% endif %}
                    <a href="{{spotify_info}}" target="_blank">
                        <!-- source: https://phosphoricons.com/ -->
                        {{ open("static/files/images/info.svg").read().replace('<svg ','<svg class="info-icon' + black_theme + '" ')  }}
                    </a>
                  </div>

                  <ul>
                    <li>
                      <label for="spotify-USERNAME">Username</label>
                      <input class="spotify-setting {{black_theme}}" type="text" class="spotify-setting" id="spotify-USERNAME" name="settings.spotify-api.USERNAME" {% if not config['settings']['spotify-api']['USERNAME'].strip() == ''%}value="{{config['settings']['spotify-api']['USERNAME']}}"{% endif %}>
                      
                      <label for="spotify-CLIENT_ID">Client ID</label>
                      <input class="spotify-setting {{black_theme}}" type="text" id="spotify-CLIENT_ID" name="settings.spotify-api.CLIENT_ID" {% if not config['settings']['spotify-api']['CLIENT_ID'].strip() == ''%}value="{{config['settings']['spotify-api']['CLIENT_ID']}}"{% endif %}>
                      
                      <label for="spotify-CLIENT_SECRET">Client Secret</label>
                      <div class="password-container">
                        <input class="spotify-setting {{black_theme}}" type="password"id="spotify-CLIENT_SECRET" name="settings.spotify-api.CLIENT_SECRET" {% if not config['settings']['spotify-api']['CLIENT_SECRET'].strip() == ''%}value="{{config['settings']['spotify-api']['CLIENT_SECRET']}}"{% endif %}>
                        <span class="show-password" onclick="togglePasswordVisibility()"></span>
                      </div>
                    </li>
                  </ul>
                </div>
                
              </div>
              
              <div class="setting-category visuals black-theme">
                <h1 class="config-title">Visuals</h1>

                <div class="setting gridsize">
                  <p>Grid-size</p>
                  <div class="gridsize-container">
                    <div class="gridsize-height">
                      <label for="gridsize-height">height</label>
                      <input min="1" pattern="[0-9]*"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                        class="{{black_theme}}" type="number" id="gridsize-height" name="front.height" {% if not config['front']['height'].strip() == ''%}value="{{config['front']['height']}}"{% endif %}>
                    </div>

                    <div class="gridsize-width">
                      <label for="gridsize-width">width</label>
                      <input min="1" pattern="[0-9]*"
                        oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                        class="{{black_theme}}" type="number" id="gridsize-width" name="front.width" {% if not config['front']['width'].strip() == ''%}value="{{config['front']['width']}}"{% endif %}>
                    </div>
                  </div>
                </div>

                <div class="setting theme">
                  <label for="theme">Theme</label>
                  <select id="theme" name="front.theme">
                    {% for theme in themes %}
                      <option value="{{theme}}" {% if config['front']['theme'].lower() == theme %}selected{% endif %}>{{theme}}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="setting background">
                  <label for="setting-background">Background image</label>
                  <button type="button" id="setting-background" class="{{black_theme}}">
                    Open the backgrounds menu
                  </button>
                  <input type="text" name="front.background" id="choose-background-handler" class="invisible" value="{{config["front"]["background"]}}">
                </div>

                <div class="setting black-theme">
                  <p>Black theme</p>
                  <label for="black-theme" class="switch">
                    <input class="{{black_theme}}" type="checkbox" id="black-theme" name="front.black-theme" {% if config['front']['black-theme'].lower() == 'true'%}checked{% endif %}>
                    <span class="slider round"></span>
                  </label>
                </div>
                
                
                <div class="setting show-names">
                  <p>Show button names</p>
                  <label for="show-names"  class="switch">
                    <input class="{{black_theme}}" type="checkbox" id="show-names" name="front.show-names" {% if config['front']['show-names'].lower() == 'true'%}checked{% endif %}>
                    <span class="slider round"></span>
                  </label>
                  <div class="names-color-input-container">
                    {% set default_names_color = '' %}
                    {% if config['front']['names-color'] and not config['front']['names-color'].strip() == '' %}
                      {% if config['front']['names-color'].strip().startswith('#') %}
                        {% set default_names_color = 'value="' + config['front']['names-color'].strip() + '"' %}
                      {% else %}
                        {% set default_names_color = 'value="#' + config['front']['names-color'].strip() + '"' %}
                      {% endif %}
                    {% endif %}
                    <input type="color" class="names-color-input {{black_theme}}" id="names-color-input" {{default_names_color}}>
                    <input type="text" name="front.names-color" id="names-color-hex" class="names-color-setting {{black_theme}}" placeholder="Button Names Color (HEX)" {{default_names_color}}>
                  </div>

                </div>
              </div>

              <div class="setting-category soundboard black-theme">
                <div class="settings-title-info">
                  <h1 class="config-title">Soundboard</h1>
                  {% set soundboard_info = "https://github.com/LeLenoch/WebDeck/blob/master/static/files/FAQ-en.md#how-to-set-up-my-soundboard" %}
                  {% if config.settings.language == "fr" %}
                    {% set soundboard_info = "https://github.com/LeLenoch/WebDeck/blob/master/static/files/FAQ-fr.md#comment-configurer-ma-soundboard-" %}
                  {% endif %}
                  <a href="{{soundboard_info}}" target="_blank">
                      <!-- source: https://phosphoricons.com/ -->
                      {{ open("static/files/images/info.svg").read().replace('<svg ','<svg class="info-icon' + black_theme + '" ')  }}
                  </a>
                </div>


                <div class="setting mic_input_device">
                  <label for="mic_input_device">Input device</label>
                  <select id="mic_input_device" name="settings.soundboard.mic_input_device">
                    {% set audio_devices = select_audio_device() %}
                    {% for device in audio_devices %}
                      {% set mic_input_device = config['settings']['soundboard']['mic_input_device'] %}
                      {% if not device.endswith(')') and '(' in device %}
                        {% set device = device + "..." %}
                      {% endif %}
                      <option value="{{device.replace('...','')}}" {% if mic_input_device[mic_input_device.find("(") + 1:].lower() in device.lower() %}selected{% endif %}>
                        {{device}}
                      </option>
                    {% endfor %}
                  </select>
                </div>
                  
                <div class="setting mic_output_device">
                  <label for="mic_output_device">Output device (vbcable)</label>
                  <select id="mic_output_device" name="settings.soundboard.vbcable">
                    {% set audio_devices = select_audio_device('output') %}
                    {% for device in audio_devices %}
                      {% set mic_output_device = config['settings']['soundboard']['vbcable'] %}
                      {% if not device.endswith(')') and '(' in device %}
                        {% set device = device + "..." %}
                      {% endif %}
                      <option value="{{device.replace('...','')}}" {% if mic_output_device[mic_output_device.find("(") + 1:].lower() in device.lower() %}selected{% endif %}>
                        {{device}}
                      </option>
                    {% endfor %}
                  </select>
                </div>

                <div class="setting ear-soundboard">
                  <p>Ear Soundboard</p>
                  <label for="ear-soundboard" class="switch">
                    <input class="{{black_theme}}" type="checkbox" id="ear-soundboard" name="settings.ear-soundboard" {% if config['settings']['ear-soundboard'].lower() == 'true'%}checked{% endif %}>
                    <span class="slider round"></span>
                  </label>
                </div>

              </div>

              <div class="setting-category experimental black-theme">
                <h1 class="config-title">Experimental</h1>
                
                <div class="setting usage-reload-time">
                  <label for="usage-reload-time">Usage buttons reload time (ms)</label>
                  <input required class="{{black_theme}}" type="number" min="0" pattern="[0-9]*"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '');"
                    id="usage-reload-time" name="front.computer-usage-reload-time"
                    {% if not config['front']['computer-usage-reload-time'].strip() == '' %}
                      value="{{ config['front']['computer-usage-reload-time'] }}"
                    {% else %}
                      value="3000"
                    {% endif %}
                  >  
                </div>
                
                <div class="setting open-settings-in-browser">
                  <p>Open settings in browser</p>
                  <label for="open-settings-in-browser" class="switch">
                    <input class="{{black_theme}}" type="checkbox" id="open-settings-in-browser" name="settings.open-settings-in-browser" {% if config['settings']['open-settings-in-browser'].lower() == 'true'%}checked{% endif %}>
                    <span class="slider round"></span>
                  </label>
                </div>

                <div class="setting gpu_method">
                  <label for="gpu_method">GPU usage method (if the gpu usage does not show)</label>
                  <select id="gpu_method" name="settings.gpu_method">
                    <option value="nvidia (pynvml)" {% if config['settings']['gpu_method'].lower() == 'nvidia (pynvml)' %}selected{% endif %}>nvidia (pynvml)</option>
                    <option value="nvidia (GPUtil)" {% if config['settings']['gpu_method'].lower() == 'nvidia (gputil)' %}selected{% endif %}>nvidia (GPUtil)</option>
                    <option value="AMD" {% if config['settings']['gpu_method'].lower() == 'amd' %}selected{% endif %}>AMD (doesn't work)</option>
                    <option value="Intel" {% if config['settings']['gpu_method'].lower() == 'intel' %}selected{% endif %}>Intel (lmao)</option>
                    <option value="None" {% if config['settings']['gpu_method'].lower() == 'none' %}selected{% endif %}>None</option>
                  </select>
                </div>
                
                {# <div class="setting data-transfer-method">
                  <label for="data-transfer-method">Data transfer method</label>
                  <select id="data-transfer-method" name="settings.data-transfer-method">
                    <option value="http" {% if config['settings']['data-transfer-method'].lower() == 'http' %}selected{% endif %}>http</option>
                    <option value="socket" {% if config['settings']['data-transfer-method'].lower() == 'socket' %}selected{% endif %}>socket</option>
                  </select>
                </div> #}

                <div class="setting show-console">
                  <p>Show console</p>
                  <label for="show-console" class="switch">
                    <input class="{{black_theme}}" type="checkbox" id="show-console" name="settings.show-console" {% if config['settings']['show-console'].lower() == 'true'%}checked{% endif %}>
                    <span class="slider round"></span>
                  </label>
                </div>

                <div class="setting dev-mode">
                  <p>Dev mode</p>
                  <label for="dev-mode" class="switch">
                    <input class="{{black_theme}}" type="checkbox" id="dev-mode" name="settings.dev-mode" {% if config['settings']['dev-mode'].lower() == 'true'%}checked{% endif %}>
                    <span class="slider round"></span>
                  </label>
                </div>
              </div>
              
              <input type="submit" value="Save" class="modal-button save-config {{black_theme}}">
            </form>
          </div>
          
        </div>

      </div>
    </div>


    <div class="addbutton-modal-container {{black_theme}}">
      <div class="addbutton-modal-content {{black_theme}}" id="addbutton-modal-content">

        <div class="addbutton-modal-header bold">
          <h1 class="addbutton-modal">Add a button</h1>
          <div class="addbutton-modal-close">
            <svg class="addbutton-config-modal {{black_theme}}" xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
              <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/>
            </svg>
          </div>
        </div>

        <div class="addbutton-modal-main">
          <br class="addbutton-container {{black_theme}}">

            
            <div class="all-commands {{black_theme}}">
              {% for category, category_value in commands.items() %}
                <button class="dropdown-btn {{black_theme}}" dropdown-category="{{category}}">{{category}}</button>
                <div class="dropdown-container">
                  {% set arg_modal_ID1 = loop.index0 %}
                  {% for command, command_value in category_value.items() %}
                    {% set arg_modal_ID = str(arg_modal_ID1) + "X" + str(loop.index0) %}
                    {# {{ mdebug(command) }} #}
                    <div class="dropdown-item-container">
                      {% set command_name = command %}
                      {% if command_value["name"] %}
                        {% if command_value["name"][config.settings.language] %}
                          {% set command_name = command_value["name"][config.settings.language] %}
                        {% elif command_value["name"]["en"] %}
                          {% set command_name = command_value["name"]["en"] %}
                        {% elif command_value["name"][0] %}
                          {% set command_name = command_value["name"][0] %}
                        {% endif %}
                      {% endif %}
                      {% set command_desc = "" %}
                      {% if command_value["description"] %}
                        {% if command_value["description"][config.settings.language] %}
                          {% set command_desc = command_value["description"][config.settings.language] %}
                        {% elif command_value["description"]["en"] %}
                          {% set command_desc = command_value["description"]["en"] %}
                        {% elif command_value["description"][0] %}
                          {% set command_desc = command_value["description"][0] %}
                        {% endif %}
                      {% endif %}
                      {% set command_id = command_value["command"] %}

                      {% if command_value["description"] %}
                        <div class="addbutton-description"> <p>{{command_desc}} </p></div>
                      {% endif %}

                      {% if not command_value["TYPE"] == "multiple" %}
                        
                        {# <button arg_modal_ID="{{ arg_modal_ID }}" class="dropdown-btn no-dropdown" id="open-button-{{ arg_modal_ID }}" dropdown-commandTag="{{command}}" onclick="argsInput('commands[\'{{category}}\'][\'{{command}}\']')" > {{command_name}} </button> #}
                        <button arg_modal_ID="{{ arg_modal_ID }}" class="dropdown-btn no-dropdown {{black_theme}}" id="open-button-{{ arg_modal_ID }}" dropdown-commandTag="{{command}}"> {{command_name}} </button>
                      
                        {% include 'addbutton_modal.jinja' %}

                      {% else %}
                        {# si type = multiple #}

                        {% if command_value["name"] %}
                          {% if command_value["name"][config.settings.language] %}
                            {% set command = command_value["name"][config.settings.language] %}
                          {% elif command_value["name"]["en"] %}
                            {% set command = command_value["name"]["en"] %}
                          {% elif command_value["name"][0] %}
                            {% set command = command_value["name"][0] %}
                          {% endif %}
                        {% endif %}

                        {% set command_values = command_value["commands"] %}
                        <button class="dropdown-btn {{black_theme}}" dropdown-category="{{command}}">{{command}}</button>
                        <div class="dropdown-container">
                          <div class="dropdown-item-container">
                            {% for command_value in command_values %}
                              {% set arg_modal_ID = str(arg_modal_ID) + "X" + str(loop.index0) %}
                              {% set command = command_value["command"].replace('/','') %}
                              {# {{ mdebug(command) }} #}
                              {% set command_name = command %}
                              {% if command_value["name"] %}
                                {% if command_value["name"][config.settings.language] %}
                                  {% set command_name = command_value["name"][config.settings.language] %}
                                {% elif command_value["name"]["en"] %}
                                  {% set command_name = command_value["name"]["en"] %}
                                {% elif command_value["name"][0] %}
                                  {% set command_name = command_value["name"][0] %}
                                {% endif %}
                              {% endif %}
                              {% set command_desc = "" %}
                              {% if command_value["description"] %}
                                {% if command_value["description"][config.settings.language] %}
                                  {% set command_desc = command_value["description"][config.settings.language] %}
                                {% elif command_value["description"]["en"] %}
                                  {% set command_desc = command_value["description"]["en"] %}
                                {% elif command_value["description"][0] %}
                                  {% set command_desc = command_value["description"][0] %}
                                {% endif %}
                              {% endif %}
                              {% set command_id = command_value["command"] %}
                              {% if command_value["description"] %}
                                <div class="addbutton-description"> <p>{{command_desc}} </p></div>
                              {% endif %}
                              
                              <button arg_modal_ID="{{ arg_modal_ID }}" class="dropdown-btn no-dropdown {{black_theme}}" id="open-button-{{ arg_modal_ID }}" dropdown-commandTag="{{command}}"> {{command_name}} </button>
                              
                              {% include 'addbutton_modal.jinja' %}


                            {% endfor %}
                          </div>
                        </div>



                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% endfor %}


            <script>
              // dropdown dans add a button

              var dropdown = document.getElementsByClassName("dropdown-btn");
              var i;

              for (let i = 0; i < dropdown.length; i++) {
                (function(index) {
                  dropdown[index].addEventListener("click", function() {
                    if (!(dropdown[index].classList.contains("final-btn") || dropdown[index].classList.contains("no-dropdown"))) {
                      this.classList.toggle("active");
                    }
                    var dropdownContent = this.nextElementSibling;
                    try {
                      if (dropdownContent.style.display === "block") {
                        if (!dropdownContent.classList.contains("addbutton-description")) {
                          dropdownContent.style.display = "none";
                        }
                      } else {
                        dropdownContent.style.display = "block";
                      }
                    } catch (error) {
                      // Ne rien faire (pass)
                    }
                  });
                })(i);
              }
              
            </script>

          </div>
        </div>
      </div>
    </div>


    {% if config['settings']['data-transfer-method'] == 'socket' %}
      <script src="static/js/socketio.js"></script>
      {# <script src="https://cdn.socket.io/4.3.2/socket.io.esm.min.js"></script> #}
    {% endif %}

    <script type="text/javascript">
      const biggest_folder = "{{ biggest_folder }}";

      if (window.location !== window.parent.location) {
          console.log("La page est charge dans un iframe.");
          var goFullscreen = window.parent.goFullscreenIFRAME;
      } else {
          console.log("La page n'est pas charge dans un iframe.");
          function goFullscreen() {
            var element = document.documentElement; // L'lment  mettre en mode plein cran
          
            if (element.requestFullscreen) {
              element.requestFullscreen();
            } else if (element.webkitRequestFullscreen) { /* Safari */
              element.webkitRequestFullscreen();
            } else if (element.msRequestFullscreen) { /* IE11 */
              element.msRequestFullscreen();
            }
          }
      }

      {% for folder_id, value in config["front"]["buttons"].items() %}
        function folder_{{ folder_id }}() {
          // console.log("{{folder_id}} opened")
          {% for folder_id2, value in config["front"]["buttons"].items() %}
            {% if folder_id2 == folder_id %}
              document.getElementById('folder-{{ folder_id2 }}').classList.remove('invisible');
            {% else %}
              document.getElementById('folder-{{ folder_id2 }}').classList.add('invisible');
            {% endif %}
          {% endfor %}
        }
      {% endfor %}

      function togglePasswordVisibility() {
        var motDePasseInput = document.getElementById("spotify-CLIENT_SECRET");
        var showPasswordIcon = document.querySelector(".show-password");
      
        if (motDePasseInput.type === "password") {
          motDePasseInput.type = "text";
          showPasswordIcon.classList.add("active");
        } else {
          motDePasseInput.type = "password";
          showPasswordIcon.classList.remove("active");
        }
      }

      // Empcher la mise en veille de l'cran lorsque l'utilisateur est inactif
      const wakeLock = async () => {
        try {
          const wakeLock = await navigator.wakeLock.request('screen');
          
          // wakeLock.release();
        } catch (err) {}
      };
      // Appeler la fonction pour activer le verrouillage de l'cran lorsque l'utilisateur interagit avec le site
      document.addEventListener('click', wakeLock);


      {#
      function loop() {
        {% if config['settings']['data-transfer-method'] == 'socket' %}
          socket.emit('message_from_socket', 'loop');
        {% else %}
          fetch('/send-data', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: 'loop' })
          })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error(error));
        {% endif %}
      }
      setInterval(loop, 5000); #}


      let config = {};
      let tempEditorConfig = {};

      async function get_config() {
        try {
          const response = await fetch('/get_config');
          if (!response.ok) {
            throw new Error('Une erreur est survenue lors du chargement des paramtres.');
          }
          const configData = await response.json();
          console.log(configData); // Log the config data if needed
          return configData;
        } catch (error) {
          console.error(error);
          throw error; // Rethrow the error if needed
        }
      }

      async function loadConfig() {
        try {
          const config = await get_config();
          return config;
        } catch (error) {
          return null;
        }
      }


      function auto_resize() {
        folder_{{biggest_folder}}();  // Appel initial  la fonction folder_{{biggest_folder}}
        const div = document.querySelector('#folder-{{biggest_folder}}');
        let currentZoom = 1;

        function applyZoom(newZoom) {
          currentZoom = newZoom;
          const scalePercentage = 100 / currentZoom;
          document.body.style.transformOrigin = "left top";
          document.body.style.transform = `scale(${currentZoom})`;
          document.body.style.width = `${scalePercentage}%`;
          document.body.style.height = `${scalePercentage}%`;
        }

        while (true) {
          const rect = div.getBoundingClientRect();
          if (!(rect.right > window.innerWidth || rect.bottom > window.innerHeight)) {
            currentZoom += 0.1;
            applyZoom(currentZoom);
          } else {
            folder_{{str(config["front"]["buttons"].keys()).split("'")[1]}}();
            break;
          }
        }

        while (true) {
          const rect = div.getBoundingClientRect();
          if (rect.right > window.innerWidth || rect.bottom > window.innerHeight) {
            currentZoom -= 0.05;
            applyZoom(currentZoom);
          } else {
            folder_{{str(config["front"]["buttons"].keys()).split("'")[1]}}();
            break;
          }
        }
      }


      window.addEventListener('load', function() {
        folder_{{str(config["front"]["buttons"].keys()).split("'")[1]}}();
        auto_resize();

        const usageValueDivs = document.querySelectorAll('.usage-value');
        if (usageValueDivs.length > 0) {
          setInterval(function() {
            //console.log('interval');
            // Rcuprer tous les formulaires avec un champ input qui commence par "/usage" et contient "cpu usage_percent"
            var forms = document.querySelectorAll('form');
            const messages = [];

            // Rcuprer les messages de chaque formulaire
            forms.forEach(form => {
              const messageElement = form.querySelector('.message');
              if (messageElement) {
                const message = messageElement.value;
                messages.push({ form: form, message: message });
              }
            });


            // Effectuer une requte fetch pour tous les messages et mettre  jour les lments DOM correspondants
            try {
              fetch('/usage', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ messages: messages })
              })
                .then(response => response.json())
                .then(usage_dict => {
                  // console.log(usage_dict);
                  forms.forEach(form => {
                    const divElements = document.querySelectorAll('.usage-value');
                    divElements.forEach(divElement => {
                      const otherClass = divElement.classList[1];
                      if (otherClass !== undefined || eval(otherClass).replace(' ','') !== '-') {
                        try {
                          let newValue;
                          if (otherClass.includes('percent')) {
                            newValue = eval(otherClass) + '%';
                          } else if (otherClass.includes('_gb')) {
                            newValue = eval(otherClass) + ' gb';
                          } else if (otherClass.includes('_mb')) {
                            newValue = eval(otherClass) + ' mb';
                          } else if (otherClass.includes('bytes')) {
                            newValue = eval(otherClass) + ' bytes';
                          } else {
                            newValue = eval(otherClass);
                          }
                          if (!newValue.includes('undefined')) {
                            divElement.innerHTML = newValue;
                          }
                        } catch (error) {
                          return;
                        }
                      }
                    });
                  });
                })
                .catch(error => console.error(error));
            } catch (e) {
              console.log(e.message);
            }
          }, {{ config['front']['computer-usage-reload-time'] }} );
        }
      });

      document.addEventListener("DOMContentLoaded", function() {

        fetch('/get_config')
          .then(function (response) {
            let tempEditorConfig = {};
            if (response.ok) {
              return response.json();
            } else {
              throw new Error('Une erreur est survenue lors du chargement des paramtres.');
            }
          })
          .then(function (configData) {
            // Utilisez les donnes de configuration retournes
            tempEditorConfig = configData; // Stocker les donnes JSON dans la variable "configData"
          })
          .catch(function (error) {
            console.error(error);
          });

        // =========== EDITORMODE ======== START
        var buttons = document.querySelectorAll('.createbutton_submit');
        
        buttons.forEach(function(button) {
            button.addEventListener('click', function() {
                fetch('/save_buttons_only', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(tempEditorConfig)
                })
                .then(function(response) {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Une erreur est survenue lors de l\'enregistrement des paramtres.');
                    }
                })
                .then(function(response) {
                    if (response.success) {
                        console.log('Les paramtres ont t enregistrs avec succs.');
                    } else {
                        console.log('Une erreur est survenue lors de l\'enregistrement des paramtres.');
                    }
                })
                .catch(function(error) {
                    console.log(error.message);
                });
            });
        });

        var openFolderDivs = document.querySelectorAll('.swapMode-open-folder');
        var isMouseOverOpenFolder = false;
        
        for (var i = 0; i < openFolderDivs.length; i++) {
          openFolderDivs[i].addEventListener('mouseover', function() {
            isMouseOverOpenFolder = true;
          });
          openFolderDivs[i].addEventListener('mouseout', function() {
            setTimeout(function() {
              isMouseOverOpenFolder = false;
            }, 150); // 150 millisecondes = 0,15 seconde
          });
        }
        
        var forms = document.querySelectorAll('form');
        forms.forEach(form => {
            form.addEventListener('submit', function(event) {
                if (swapMode === 1) {
                    // Empchez l'envoi du formulaire par dfaut
                    event.preventDefault();
                }
            });
        });

        // Rcuprer les lments ncessaires
        const folderIndex = document.getElementById('folder-index');
        let editorMode = 0;
        let ifModif = 0;
        let swapMode = 0;
        var savedOnClicks = {};
        var swapChanges = [];
        var swapUNChanges = [];
        console.log(`swapChanges: ${swapChanges}`);
      
        // Fonction pour afficher la bote de dialogue de confirmation d'ajout
        function showAddConfirmation(event) {
            // if (confirm("Souhaitez-vous vraiment ajouter ce bouton ?")) {
            //     // L'utilisateur a confirm
            //     // Effectuer ici l'action d'ajout du bouton
            //     console.log("Le bouton a t ajout.");
            //     ifModif = 1;
            // }
            console.log("Le bouton est en train d'tre ajout");
        }
      
        // Fonction pour afficher la bote de dialogue de confirmation de suppression
        function showDeleteConfirmation(event) {
            if (editorMode === 1 && confirm("Souhaitez-vous vraiment supprimer ce bouton ?")) {
                ifModif = 1;

                let closest_form = event.target.closest('form.form');
                if (closest_form === null) {
                    closest_form = event.target.closest('div.void');
                }
                const voidDiv = document.createElement('div');
                voidDiv.classList.add('void');
                const addButtonDiv = document.createElement('div');
                addButtonDiv.classList.add('add-button');
                addButtonDiv.style.display = 'flex';
                addButtonDiv.style.top = '40.3675';
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                svg.setAttribute('width', '20');
                svg.setAttribute('height', '20');
                svg.setAttribute('viewBox', '0 0 24 24');
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M12 4v16m8-8H4');
                path.setAttribute('stroke', 'currentColor');
                path.setAttribute('stroke-width', '2');
                path.setAttribute('stroke-linecap', 'round');
                path.setAttribute('stroke-linejoin', 'round');
      
                svg.appendChild(path);
                addButtonDiv.appendChild(svg);
                voidDiv.appendChild(addButtonDiv);
      
                const parentId = closest_form.parentNode.id.replace(/^folder-/, '');
                const formClass = closest_form.className;
                const formClassMatch = formClass.match(/form-(\d+)/);
                const formNumber = formClassMatch ? formClassMatch[1] : '';
                const formIndex = parseInt(formNumber) - 1;
                console.log(`${parentId} > ${formNumber}`);
      
                loadConfig().then((config) => {
                  tempEditorConfig = config;
                  tempEditorConfig['front']['buttons'][parentId][formNumber] = {
                    "VOID": "VOID"
                  };
                  closest_form.parentNode.replaceChild(voidDiv, closest_form);
        
                  console.log("Le bouton a t supprim.");
                  console.log(tempEditorConfig);
                });
      
            }
        }
      
        function showEditWindow(event) {
            // ifModif = 1;
            console.log('edit press');
        }
      
        let swapFirstBtn = 0;
        let swapSecondBtn = 0;
        function swapButton(event) {
            if (editorMode === 1 && swapMode === 1 && !isMouseOverOpenFolder) {
                let closest_form = event.target.closest('form.form');
                if (closest_form === null) {
                    closest_form = event.target.closest('div.void');
                }
                const parentId = closest_form.parentNode.id.replace(/^folder-/, '');
                const formClass = closest_form.className;
                const formClassMatch = formClass.match(/form-(\d+)/);
                const formNumber = formClassMatch ? formClassMatch[1] : '';
                const formIndex = parseInt(formNumber) - 1;
                
                const checkbox = closest_form.querySelector('div.checkbox');
                if (swapFirstBtn === 0) {
                    // enregistrer le premier btn
                    swapFirstBtn = `${parentId};;;${formNumber}`;
                    console.log(`1: ${swapFirstBtn}\n2: ${swapSecondBtn}`);
                    if (checkbox !== null) {
                      checkbox.classList.add('checkbox-checked');
                    }
                } else if (swapSecondBtn === 0) {
                    // enregistrer le second btn si le premier est dj enregistr
                    if (swapFirstBtn === `${parentId};;;${formNumber}`) {
                        swapFirstBtn = 0;
                        console.log(`1: ${swapFirstBtn}\n2: ${swapSecondBtn}`);
                        if (checkbox !== null) {
                          checkbox.classList.remove('checkbox-checked');
                        }
                    } else {
                        if (checkbox !== null) {
                          checkbox.classList.add('checkbox-checked');
                        }
                        swapSecondBtn = `${parentId};;;${formNumber}`;
                        if (swapFirstBtn !== 0) {
                            // both btns are selected
                            console.log("both btns are selected");
                            const [parentId1, formNumber1] = swapFirstBtn.split(";;;");
                            const [parentId2, formNumber2] = swapSecondBtn.split(";;;");
      
                            // Get the form elements
                            const form1 = document.querySelector(`#folder-${parentId1} .form-${formNumber1}`);
                            const form2 = document.querySelector(`#folder-${parentId2} .form-${formNumber2}`);
      
                            // Get the parent elements
                            const parent1 = form1.parentNode;
                            const parent2 = form2.parentNode;
      
                            // Swap the forms
                            const temp = document.createElement('div');
                            temp.innerHTML = form1.innerHTML;
                            // Copier le contenu de form2 vers form1
                            form1.innerHTML = form2.innerHTML;
                            // Copier le contenu du temporaire (contenant le contenu initial de form1) vers form2
                            form2.innerHTML = temp.innerHTML;
      
                            // refresh les boutons del et edit aprs dplacement
                            let editButtonElements = document.querySelectorAll('.edit-button');
                            let deleteButtonElements = document.querySelectorAll('.delete-button');
                            for (let i = 0; i < editButtonElements.length; i++) {
                                editButtonElements[i].addEventListener('click', showEditWindow);
                            }
                            for (let i = 0; i < deleteButtonElements.length; i++) {
                                deleteButtonElements[i].addEventListener('click', showDeleteConfirmation);
                            }

                            let tempValue = tempEditorConfig['front']['buttons'][parentId1][formNumber1];
                            tempEditorConfig['front']['buttons'][parentId1][formNumber1] = tempEditorConfig['front']['buttons'][parentId2][formNumber2];
                            tempEditorConfig['front']['buttons'][parentId2][formNumber2] = tempValue;

                            // Reset the variables
                            const checkboxDivs = document.querySelectorAll('div.checkbox');
                            checkboxDivs.forEach(
                              div => div.classList.remove('checkbox-checked')
                            );
                            
                            swapChanges.push(`${parentId1};;;${formNumber1} > ${parentId2};;;${formNumber2}`);
                            console.log(`swapChanges: ${swapChanges}`);

                            swapFirstBtn = 0;
                            swapSecondBtn = 0;
                            console.log(`sucessfully swapped ${parentId1};;;${formNumber1} to ${parentId2};;;${formNumber2}`);
                            ifModif = 1;
                        }
                        console.log(`1: ${swapFirstBtn}\n2: ${swapSecondBtn}`);
                    }
                }
                else {
                    // means that both buttons are selected and the swap didnt worked
                    console.log("if you see this, it means my code is REALLY really bad. But it works, I hope.")
                }
            }
        }
      
      
      
        // Ajouter la classe CSS pour la croix lors de la modification de editorMode
        function toggleEditorMode() {
            let addButtonElements = document.querySelectorAll('.add-button');
            let editButtonElements = document.querySelectorAll('.edit-button');
            let deleteButtonElements = document.querySelectorAll('.delete-button');
            // Fonction pour grer la visibilit des divs "add-button"
            for (let i = 0; i < addButtonElements.length; i++) {
                addButtonElements[i].style.display = editorMode === 0 ? 'none' : 'flex';
            }
            for (let i = 0; i < editButtonElements.length; i++) {
                editButtonElements[i].style.display = editorMode === 0 ? 'none' : 'flex';
            }
            for (let i = 0; i < deleteButtonElements.length; i++) {
                deleteButtonElements[i].style.display = editorMode === 0 ? 'none' : 'flex';
            }
            EditorButtons.style.display = editorMode === 0 ? 'none' : 'flex';
            EditorButtonsFolders.style.display = editorMode === 0 ? 'none' : 'block';
        }
        function hideEditorPartially() {
          let editButtonElements = document.querySelectorAll('.edit-button');
          let deleteButtonElements = document.querySelectorAll('.delete-button');
          let addButtonElements = document.querySelectorAll('.add-button');
          for (let i = 0; i < addButtonElements.length; i++) {
              addButtonElements[i].style.display = 'none'
          }
          for (let i = 0; i < editButtonElements.length; i++) {
              editButtonElements[i].style.display = 'none'
          }
          for (let i = 0; i < deleteButtonElements.length; i++) {
              deleteButtonElements[i].style.display = 'none'
          }
        }
        function showEditorPartially() {
          let editButtonElements = document.querySelectorAll('.edit-button');
          let deleteButtonElements = document.querySelectorAll('.delete-button');
          let addButtonElements = document.querySelectorAll('.add-button');
          for (let i = 0; i < addButtonElements.length; i++) {
              addButtonElements[i].style.display = 'flex'
          }
          for (let i = 0; i < editButtonElements.length; i++) {
              editButtonElements[i].style.display = 'flex'
          }
          for (let i = 0; i < deleteButtonElements.length; i++) {
              deleteButtonElements[i].style.display = 'flex'
          }
        }
      
        // Ajouter un gestionnaire d'vnements pour le clic sur le bouton editorButton
        editorButton.addEventListener('click', function () {
            editorMode = editorMode === 0 ? 1 : 0;
            toggleEditorMode();
            editorButton.textContent = editorMode === 0 ? '[Q] Enter editor mode' : '[Q] Exit editor mode';
            console.log('La valeur de editorMode a t modifie :', editorMode);
            if (editorMode === 1) {
                fetch('/get_config')
                    .then(function (response) {
                        let tempEditorConfig = {};
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('Une erreur est survenue lors du chargement des paramtres.');
                        }
                    })
                    .then(function (configData) {
                        tempEditorConfig = configData;
                        // console.log(tempEditorConfig);
                    })
                    .catch(function (error) {
                        console.error(error);
                    });
            } else {
              if (ifModif === 1) {
                console.log(`swapChanges ${swapChanges}`);
                // while (swapChanges.length > 0) {
                //   console.log(swapChanges.length);
                //   undoSwap()
                // }
                location.reload();
              }
              editorMode = 0;
              swapMode = 0;
              showEditorPartially()
              swapEditorButton.childNodes[1].nodeValue = '[S] Swap 2 Buttons'
              swapFirstBtn = 0;
              swapSecondBtn = 0;
              swapChanges = []
              console.log(`swapChanges: ${swapChanges}`);
              toggleEditorMode();
              editorButton.textContent = editorMode === 0 ? '[Q] Enter editor mode' : '[Q] Exit editor mode';
              console.log('La valeur de editorMode a t modifie :', editorMode);
            }
        });
      
        // Ajouter un gestionnaire d'vnements pour le clic sur le bouton exitEditorButton
        const exitEditorButton = document.getElementById('exitEditorButton');
        exitEditorButton.addEventListener('click', function () {
          editorMode = editorMode === 0 ? 1 : 0;
            toggleEditorMode();
            editorButton.textContent = editorMode === 0 ? '[Q] Enter editor mode' : '[Q] Exit editor mode';
            console.log('La valeur de editorMode a t modifie :', editorMode);
            if (editorMode === 1) {
              fetch('/get_config')
                .then(function (response) {
                  let tempEditorConfig = {}; // Dclarer tempEditorConfig
                  if (response.ok) {
                    return response.json();
                  } else {
                    throw new Error('Une erreur est survenue lors du chargement des paramtres.');
                  }
                })
                .then(function (configData) {
                  // Utilisez les donnes de configuration retournes
                  tempEditorConfig = configData; // Stockez les donnes JSON dans la variable "configData"
                })
                .catch(function (error) {
                  // Grez les erreurs ici
                  console.error(error);
                });
            } else {
              if (ifModif === 1) {
                console.log(`swapChanges ${swapChanges}`);
                // while (swapChanges.length > 0) {
                //   console.log(swapChanges.length);
                //   undoSwap()
                // }
                location.reload();
              }
              swapEditorButtonFunction()
              editorMode = 0;
              toggleEditorMode();
              editorButton.textContent = editorMode === 0 ? '[Q] Enter editor mode' : '[Q] Exit editor mode';
              console.log('La valeur de editorMode a t modifie :', editorMode);
            }
        });
      
        // Ajouter un gestionnaire d'vnements pour le clic sur le bouton SaveExitEditorButton
        function SaveExitEditor(tempEditorConfig) {
          editorMode = 0;
          swapMode = 0;
          showEditorPartially()
          swapEditorButtonFunction()
          swapEditorButton.childNodes[1].nodeValue = '[S] Swap 2 Buttons'
          swapFirstBtn = 0;
          swapSecondBtn = 0;
          swapChanges = []
          console.log(`swapChanges: ${swapChanges}`);
          toggleEditorMode();
          if (ifModif === 1 || swapChanges.length !== 0) {
              fetch('/save_buttons_only', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(tempEditorConfig)
              })
              .then(function(response) {
                  if (response.ok) {
                      // Le serveur a enregistr les donnes avec succs
                      return response.json();
                  } else {
                      // Le serveur a retourn une erreur
                      throw new Error('Une erreur est survenue lors de l\'enregistrement des paramtres.');
                  }
              })
              .then(function(response) {
                  if (response.success) {
                      // Le serveur a enregistr les donnes avec succs
                      alert('Les paramtres ont t enregistrs avec succs.');
                      location.reload();
                  } else {
                      // Le serveur a retourn une erreur
                      alert('Une erreur est survenue lors de l\'enregistrement des paramtres.');
                  }
              })
              .catch(function(error) {
                  // Une erreur s'est produite
                  alert(error.message);
              });
          }
          console.log('La valeur de editorMode a t modifie :', editorMode);
        }

        const SaveExitEditorButton = document.getElementById('SaveExitEditorButton');
        SaveExitEditorButton.addEventListener('click', function () {
          console.log('tempEditorConfig:');
          console.log(JSON.stringify(tempEditorConfig));
          SaveExitEditor(tempEditorConfig);
        });
        // Ajouter un gestionnaire d'vnements pour le clic sur le bouton exitEditorButton
        function swapEditorButtonFunction(event) {
          swapMode = swapMode === 0 ? 1 : 0;
          const swapEditorButton = document.getElementById('swapEditorButton');
          swapEditorButton.childNodes[1].nodeValue = swapMode === 0 ? '[S] Swap 2 Buttons' : '[S] Stop Swap Mode';
          swapFirstBtn = 0;
          swapSecondBtn = 0;
          console.log('La valeur de swapMode a t modifie :', swapMode);

          var checkboxDivs = document.querySelectorAll('div.checkbox');
          var openFolderDivs = document.querySelectorAll('.swapMode-open-folder');
          if (editorMode === 1 && swapMode === 1) {
            swapEditorButton.childNodes[1].nodeValue = '[S] Stop Swap Mode';
            hideEditorPartially()
            // afficher swapMode-open-folder
            for (var i = 0; i < openFolderDivs.length; i++) {
              openFolderDivs[i].style.display = 'inline-flex';
            }
            for (var i = 0; i < checkboxDivs.length; i++) {
              checkboxDivs[i].style.display = 'block';
            }

            // retirer le onclick
            var buttons = document.getElementsByTagName('button');
          
            for (var i = 0; i < buttons.length; i++) {
              if (!buttons[i].classList.contains('EditorButtons-Folder')) {
                var button = buttons[i];
                var onclickAttr = button.getAttribute('onclick');
                var onclickHandlerAttr = button.getAttribute('onclickhandler');
            
                // Stocker temporairement l'attribut onclick dans l'objet savedOnClicks en utilisant l'attribut onclickhandler comme cl
                if (onclickHandlerAttr) {
                  savedOnClicks[onclickHandlerAttr] = onclickAttr;
                }
            
                // Supprimer l'attribut onclick
                button.removeAttribute('onclick');
              }
            }
          } else {
            swapEditorButton.childNodes[1].nodeValue = '[S] Swap 2 Buttons';
            swapMode = 0;
            showEditorPartially()

            var checkboxDivs = document.querySelectorAll('div.checkbox');
            var openFolderDivs = document.querySelectorAll('.swapMode-open-folder');
            // masquer swapMode-open-folder
            for (var i = 0; i < openFolderDivs.length; i++) {
              openFolderDivs[i].style.display = 'none';
            }
            // masquer checkbox
            for (var i = 0; i < checkboxDivs.length; i++) {
              checkboxDivs[i].style.display = 'none';
            }

            // Rappliquer les attributs onclick en fonction de l'emplacement du bouton
            var buttons = document.getElementsByTagName('button');
          
            for (var i = 0; i < buttons.length; i++) {
              if (!buttons[i].classList.contains('EditorButtons-Folder')) {
                var button = buttons[i];
                var onclickHandlerAttr = button.getAttribute('onclickhandler');
                var savedOnClick = savedOnClicks[onclickHandlerAttr];
            
                // Vrifier si un attribut onclick est sauvegard pour le bouton actuel
                if (savedOnClick) {
                  // Rappliquer l'attribut onclick depuis savedOnClicks
                  button.setAttribute('onclick', savedOnClick);
                }
              }
            }
            swapChanges = []
            console.log(`swapChanges: ${swapChanges}`);
          }
        }

        function undoSwap() {
          let lastChange = swapChanges[swapChanges.length - 1];
          console.log(`All changes: ${swapChanges}`)
          console.log(`Last change: ${lastChange}`)
          
          if (lastChange === undefined) {
            alert("There are no changes to undo.")
          } else {

          

            let [swapFirstBtn, swapSecondBtn] = lastChange.split(" > ");
            const [parentId1, formNumber1] = swapFirstBtn.split(";;;");
            const [parentId2, formNumber2] = swapSecondBtn.split(";;;");
            
            // Get the form elements
            const form1 = document.querySelector(`#folder-${parentId1} .form-${formNumber1}`);
            const form2 = document.querySelector(`#folder-${parentId2} .form-${formNumber2}`);
            
            // Get the parent elements
            const parent1 = form1.parentNode;
            const parent2 = form2.parentNode;
            
            // Swap the forms
            const temp = document.createElement('div');
            temp.innerHTML = form1.innerHTML;
            // Copier le contenu de form2 vers form1
            form1.innerHTML = form2.innerHTML;
            // Copier le contenu du temporaire (contenant le contenu initial de form1) vers form2
            form2.innerHTML = temp.innerHTML;
            
            // refresh les boutons del et edit aprs dplacement
            let editButtonElements = document.querySelectorAll('.edit-button');
            let deleteButtonElements = document.querySelectorAll('.delete-button');
            for (let i = 0; i < editButtonElements.length; i++) {
                editButtonElements[i].addEventListener('click', showEditWindow);
            }
            for (let i = 0; i < deleteButtonElements.length; i++) {
                deleteButtonElements[i].addEventListener('click', showDeleteConfirmation);
            }
            let tempValue = tempEditorConfig['front']['buttons'][parentId1][formNumber1];
            tempEditorConfig['front']['buttons'][parentId1][formNumber1] = tempEditorConfig['front']['buttons'][parentId2][formNumber2];
            tempEditorConfig['front']['buttons'][parentId2][formNumber2] = tempValue;
            // Reset the variables
            const checkboxDivs = document.querySelectorAll('div.checkbox');
            checkboxDivs.forEach(
              div => div.classList.remove('checkbox-checked')
            );
            
            swapChanges.splice(-1)
            swapUNChanges.push(`${parentId1};;;${formNumber1} > ${parentId2};;;${formNumber2}`);

            console.log(`swapUNChanges: ${swapChanges}`);
            swapFirstBtn = 0;
            swapSecondBtn = 0;
            console.log(`sucessfully unswapped ${parentId1};;;${formNumber1} to ${parentId2};;;${formNumber2}`);
            ifModif = 1;
          }
        }

        function undoUNSwap() {
          let lastChange = swapUNChanges[swapUNChanges.length - 1];
          console.log(`All changes: ${swapUNChanges}`)
          console.log(`Last change: ${lastChange}`)
          
          if (lastChange === undefined) {
            alert("There are no changes to undo.")
          } else {

          

            let [swapFirstBtn, swapSecondBtn] = lastChange.split(" > ");
            const [parentId1, formNumber1] = swapFirstBtn.split(";;;");
            const [parentId2, formNumber2] = swapSecondBtn.split(";;;");
            
            // Get the form elements
            const form1 = document.querySelector(`#folder-${parentId1} .form-${formNumber1}`);
            const form2 = document.querySelector(`#folder-${parentId2} .form-${formNumber2}`);
            
            // Get the parent elements
            const parent1 = form1.parentNode;
            const parent2 = form2.parentNode;
            
            // Swap the forms
            const temp = document.createElement('div');
            temp.innerHTML = form1.innerHTML;
            // Copier le contenu de form2 vers form1
            form1.innerHTML = form2.innerHTML;
            // Copier le contenu du temporaire (contenant le contenu initial de form1) vers form2
            form2.innerHTML = temp.innerHTML;
            
            // refresh les boutons del et edit aprs dplacement
            let editButtonElements = document.querySelectorAll('.edit-button');
            let deleteButtonElements = document.querySelectorAll('.delete-button');
            for (let i = 0; i < editButtonElements.length; i++) {
                editButtonElements[i].addEventListener('click', showEditWindow);
            }
            for (let i = 0; i < deleteButtonElements.length; i++) {
                deleteButtonElements[i].addEventListener('click', showDeleteConfirmation);
            }
            let tempValue = tempEditorConfig['front']['buttons'][parentId1][formNumber1];
            tempEditorConfig['front']['buttons'][parentId1][formNumber1] = tempEditorConfig['front']['buttons'][parentId2][formNumber2];
            tempEditorConfig['front']['buttons'][parentId2][formNumber2] = tempValue;
            // Reset the variables
            const checkboxDivs = document.querySelectorAll('div.checkbox');
            checkboxDivs.forEach(
              div => div.classList.remove('checkbox-checked')
            );
            
            swapUNChanges.splice(-1)
            swapChanges.push(`${parentId1};;;${formNumber1} > ${parentId2};;;${formNumber2}`);

            swapFirstBtn = 0;
            swapSecondBtn = 0;
            console.log(`sucessfully unswapped ${parentId1};;;${formNumber1} to ${parentId2};;;${formNumber2}`);
            ifModif = 1;
          }
        }

        const swapEditorButton = document.getElementById('swapEditorButton');
        swapEditorButton.addEventListener('click', swapEditorButtonFunction);

        document.addEventListener('keydown', function(event) {
          if (is_editbutton_modal_opened === 0 && is_addbutton_modal_opened === 0 && document.getElementById('modal-container').style.opacity !== '1') {
            if (event.key === 'e') {
              SaveExitEditor(tempEditorConfig);
            }
            if (event.key === 'q') {
              editorMode = editorMode === 0 ? 1 : 0;
              toggleEditorMode();
              editorButton.textContent = editorMode === 0 ? '[Q] Enter editor mode' : '[Q] Quit editor mode';
              console.log('La valeur de editorMode a t modifie :', editorMode);
              if (editorMode === 1) {
                fetch('/get_config')
                  .then(function (response) {
                    let tempEditorConfig = {};
                    if (response.ok) {
                      return response.json();
                    } else {
                      throw new Error('Une erreur est survenue lors du chargement des paramtres.');
                    }
                  })
                  .then(function (configData) {
                    // Utilisez les donnes de configuration retournes
                    tempEditorConfig = configData; // Stocker les donnes JSON dans la variable "configData"
                  })
                  .catch(function (error) {
                    console.error(error);
                  });
              } else {
                if (ifModif === 1) {
                  console.log(`swapChanges ${swapChanges}`);
                  // while (swapChanges.length > 0) {
                  //   console.log(swapChanges.length);
                  //   undoSwap()
                  // }
                  location.reload();
                }
                swapEditorButtonFunction()
                editorMode = 0;
                toggleEditorMode();
                editorButton.textContent = editorMode === 0 ? '[Q] Enter editor mode' : '[Q] Exit editor mode';
                console.log('La valeur de editorMode a t modifie :', editorMode);
              }
            }
            if (editorMode === 1) {
              if (event.key === 's') {
                swapEditorButtonFunction()
              }
              if (event.key === 'z' && event.ctrlKey && swapMode === 1) {
                console.log('Ctrl + Z');
                undoSwap()
              }
              if (event.ctrlKey && event.shiftKey && event.key === 'Z' && swapMode === 1) {
                console.log('Ctrl + Shift + Z');
                undoUNSwap()
              }
              if (event.key === 'y' && event.ctrlKey && swapMode === 1) {
                console.log('Ctrl + Y');
                undoUNSwap()
              }
            }
            let modal = document.querySelector('.modal-container');
            if (event.key === 'Escape' && modal.style.opacity === '1') {
              console.log('Esc (closed modal)');
              hide_modal()
            }
            if (event.key === 'c' || event.key === 'm') {
              if (modal.style.opacity !== '1') {
                console.log('M or C (opened config modal)');
                show_modal()
              } else {
                console.log('M or C (closed config modal)');
                hide_modal()
              }
            }
          }
        });
      

        const EditorButtons = document.getElementById('EditorButtons');
        const EditorButtonsFolders = document.getElementById('EditorButtons-Folders');
      
        let addButtonElements = document.querySelectorAll('.add-button');
        let editButtonElements = document.querySelectorAll('.edit-button');
        let deleteButtonElements = document.querySelectorAll('.delete-button');
      
        var AllButtons1 = document.querySelectorAll('form.form');
        var AllButtons2 = document.querySelectorAll('div.void');
        var AllButtons = Array.from(AllButtons1).concat(Array.from(AllButtons2));
      
        // Ajouter un gestionnaire d'vnement pour le clic sur le bouton +
        for (let i = 0; i < addButtonElements.length; i++) {
            addButtonElements[i].addEventListener('click', showAddConfirmation);
        }
        // Ajouter un gestionnaire d'vnement pour le clic sur le bouton edit
        for (let i = 0; i < editButtonElements.length; i++) {
            editButtonElements[i].addEventListener('click', showEditWindow);
        }
        // Ajouter un gestionnaire d'vnement pour le clic sur le bouton delete
        for (let i = 0; i < deleteButtonElements.length; i++) {
            deleteButtonElements[i].addEventListener('click', showDeleteConfirmation);
        }
        // Ajouter un gestionnaire d'vnement pour le clic sur le bouton swap
        for (let i = 0; i < AllButtons.length; i++) {
            AllButtons[i].addEventListener('click', swapButton);
        }

        // =========== EDITORMODE ======== END


        // ?modal=show ?config=show
        const urlParams = new URLSearchParams(window.location.search);
        const modalParam = urlParams.get('config');
        if (modalParam === 'show') {
          let modal = document.querySelector('.modal-container');
          modal.style.opacity = '1';
          modal.style.display = 'block';
        }

        {% if config['settings']['data-transfer-method'] == 'socket' %}
          // SOCKET CONNECTION
          var socket = io.connect('http://' + document.domain + ':' + location.port);
        
          socket.on('connect', function() {
            console.log('Connected');
          });
        
          socket.on('json_data', function(data) {
            console.log(data.message);
          });
        {% endif %}

        var forms = document.querySelectorAll('form');
        forms.forEach(form => {
          form.addEventListener('submit', function(event) {
            event.preventDefault();
        
            if (editorMode === 1 && swapMode === 1) {
              return; // Empche l'envoi du formulaire par dfaut
            }
        
            const messageElement = form.querySelector('.message');
            if (!messageElement) {
              if (form.classList.contains('config-form')) {
                  
                console.log('sending config-form...');
          
                var config_dataTemp = {};
                var inputs = document.querySelectorAll('#config-form input, #config-form select');
                inputs.forEach(function(input) {
                  var name = input.name;
                  var value;
                  if (input.type === 'checkbox') {
                    value = input.checked ? 'true' : 'false';
                  } else {
                    value = input.value;
                    if (input.id === 'language') {
                      value = value.toLowerCase();
                    }
                  }
                  config_dataTemp[name] = value;
                });
                
          
                console.log(config_dataTemp);
          
                let config_data = {};
          
                for (let key in config_dataTemp) {
                  if (key === "") continue; // Ignorer la cl sans nom
          
                  let keys = key.split(".");
                  let obj = config_data;
          
                  for (let i = 0; i < keys.length; i++) {
                    if (!obj.hasOwnProperty(keys[i])) {
                      obj[keys[i]] = {};
                    }
          
                    if (i === keys.length - 1) {
                      obj[keys[i]] = config_dataTemp[key];
                    }
          
                    obj = obj[keys[i]];
                  }
                }
          
                console.log(config_data);
          
                fetch('/save_config', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(config_data)
                })
                  .then(function(response) {
                    if (response.ok) {
                      return response.json();
                    } else {
                      throw new Error('Une erreur est survenue lors de l\'enregistrement des paramtres.');
                    }
                  })
                  .then(function(response) {
                    if (response.success) {
                      alert('Les paramtres ont t enregistrs avec succs.');
                    } else {
                      alert('Une erreur est survenue lors de l\'enregistrement des paramtres.');
                    }
                  })
                  .catch(function(error) {
                    alert(error.message);
                  });
              }
            } else {
              const message = messageElement.value;
              if (!message.startsWith("/usage") && !message.startsWith("/reload") && !message.startsWith("/folder")) {
                {% if config['settings']['data-transfer-method'] == 'socket' %}
                  socket.emit('message_from_socket', message);
                {% else %}
                  fetch('/send-data', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message })
                  })
                    .then(response => response.json())
                    .then(data => console.log(data))
                    .catch(error => console.error(error));
                {% endif %}
              } else if (message.startsWith("/reload") && swapMode !== 1) {
                console.log('reloading...');
                location.reload();
              } else {
                fetch('/usage', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ message: message })
                })
                  .then(response => response.json())
                  .then(usage_dict => {
                    const divElements = document.querySelectorAll('.usage-value');
                    divElements.forEach(divElement => {
                      const otherClass = divElement.classList[1];
                      if (otherClass !== undefined || eval(otherClass) !== '-') {
                        try {
                          let newValue;
                          if (otherClass.includes('percent')) {
                            newValue = eval(otherClass) + '%';
                          } else if (otherClass.includes('_gb')) {
                            newValue = eval(otherClass) + ' gb';
                          } else if (otherClass.includes('_mb')) {
                            newValue = eval(otherClass) + ' mb';
                          } else if (otherClass.includes('bytes')) {
                            newValue = eval(otherClass) + ' bytes';
                          } else {
                            newValue = eval(otherClass);
                          }
                          if (!newValue.includes('undefined')) {
                            divElement.innerHTML = newValue;
                          }
                        } catch (error) {
                          return;
                        }
                      }
                    });
                  })
                  .catch(error => console.error(error));
              }
            }
          });
        });
        



        // Slectionner tous les boutons qui ont la classe open-config-modal
        let open_modal_buttons = document.querySelectorAll(".open-config-modal");

        // Slectionner le conteneur de la modal
        let modal = document.querySelector(".modal-container");

        // Slectionner le bouton de fermeture de la modal
        let modal_close_button = document.querySelector(".modal-close");

        function show_modal() {
          modal.style.opacity = "100%";
          modal.style.display = "block";
        }
        function hide_modal() {
          let intervalId = setInterval(function() {
            let currentOpacity = parseFloat(getComputedStyle(modal).opacity);
            if (currentOpacity <= 0) {
              // L'animation est termine, cacher la modal
              clearInterval(intervalId);
              setTimeout(function() {
                modal.style.display = "none";
              }, 100); // Attendre avant de cacher la modal
              return;
            }
            modal.style.opacity = (currentOpacity - 3.5).toFixed(2);
          }, 10); // Rpter toutes les 0.01s (10ms)
        }

        // Ajouter un couteur d'vnement sur chaque bouton pour ouvrir la modal
        for (let button of open_modal_buttons) {
          button.addEventListener("click", function() {
            if (swapMode !== 1) {
              show_modal();
            }
          });
        }

        // Ajouter un couteur d'vnement sur le bouton de fermeture pour fermer la modal
        modal_close_button.addEventListener("click", function() {
          hide_modal();
        });

        // Ajouter un couteur d'vnement sur la modal pour la fermer en cliquant en dehors
        modal.addEventListener("click", function(event) {
          if (event.target === modal) {
            hide_modal();
          }
        });
        



        // Slectionner tous les boutons qui ont la classe open-config-modal
        let open_modal_addbutton = document.querySelectorAll("div.add-button");

        // Slectionner le conteneur de la modal
        let addbutton_modal = document.querySelector(".addbutton-modal-container");

        // Slectionner le bouton de fermeture de la modal
        let addbutton_modal_close_button = document.querySelector(".addbutton-modal-close");

        let is_addbutton_modal_opened = 0;

        function show_addbutton_modal(addFolder, addId) {
          addbutton_modal.style.opacity = "100%";
          addbutton_modal.style.display = "block";
          is_addbutton_modal_opened = 1;
          document.querySelector('#addbutton-modal-content').setAttribute('add_FOLDER', addFolder);
          document.querySelector('#addbutton-modal-content').setAttribute('add_ID', addId);
        }
        function hide_addbutton_modal() {
          document.querySelector('#addbutton-modal-content').removeAttribute('add_ID');
          document.querySelector('#addbutton-modal-content').removeAttribute('add_FOLDER');
          let intervalId = setInterval(function() {
            let currentOpacity = parseFloat(getComputedStyle(addbutton_modal).opacity);
            if (currentOpacity <= 0) {
              // L'animation est termine, cacher la modal
              clearInterval(intervalId);
              setTimeout(function() {
                addbutton_modal.style.display = "none";
              }, 100); // Attendre avant de cacher la modal
              return;
            }
            addbutton_modal.style.opacity = (currentOpacity - 3.5).toFixed(2);
          }, 10); // Rpter toutes les 0.01s (10ms)
          is_addbutton_modal_opened = 0;
        }

        // Ajouter un couteur d'vnement sur chaque bouton pour ouvrir la modal addbutton
        for (let button of open_modal_addbutton) {
          button.addEventListener("click", function() {
            if (swapMode !== 1) {
              var addIdValue = button.getAttribute('add_ID');
              var addFolderValue = button.getAttribute('add_FOLDER');
              show_addbutton_modal(addFolderValue, addIdValue);
            }
          });
        }

        // Ajouter un couteur d'vnement sur le bouton de fermeture pour fermer la modal addbutton
        addbutton_modal_close_button.addEventListener("click", function() {
          hide_addbutton_modal();
        });

        // Ajouter un couteur d'vnement sur la modal addbutton pour la fermer en cliquant en dehors
        addbutton_modal.addEventListener("click", function(event) {
          if (event.target === addbutton_modal) {
            hide_addbutton_modal();
          }
        });



        // Slectionner tous les boutons qui ont la classe open-config-modal
        let open_modal_addbutton_args = document.querySelectorAll("button.no-dropdown");
        
        // Slectionner le conteneur de chaque modal
        let addbutton_args_modal_containers = document.querySelectorAll(".addbutton-modal-container-args");
        let addbutton_args_modal = addbutton_args_modal_containers
        
        // Slectionner le bouton de fermeture de la modal
        let addbutton_args_modal_close_buttons = document.querySelectorAll(".addbutton-modal-close-args");
        

        function show_addbutton_args_modal(modalId) {
          let modal = document.getElementById("modal-container-" + modalId);
          if (modal) {
            modal.style.opacity = "100%";
            modal.style.display = "block";
            is_addbutton_modal_opened = 1;
          }
        }
        
        function hide_addbutton_args_modal() {
          let intervalId = setInterval(function() {
            let currentOpacity = parseFloat(getComputedStyle(addbutton_args_modal[0]).opacity);
            if (currentOpacity <= 0) {
              // L'animation est termine, cacher la modal
              clearInterval(intervalId);
              setTimeout(function() {
                for (let element of addbutton_args_modal) {
                  let modalId = element.getAttribute("arg_modal_ID");
                  let modal = document.getElementById("modal-container-" + modalId);
                  if (modal) {
                    element.style.display = "none";
                  }
                }
              }, 100); // Attendre avant de cacher la modal
                return;
              }
              for (let element of addbutton_args_modal) {
                element.style.opacity = (currentOpacity - 3.5).toFixed(2);
              }
            }, 10); // Rpter toutes les 0.01s (10ms)
          is_addbutton_modal_opened = 0;
        }
        
        // Ajouter des couteurs d'vnements sur chaque bouton pour ouvrir la modal correspondante
        open_modal_addbutton_args.forEach(function(button) {
          button.addEventListener("click", function() {
            let modalId = button.getAttribute("arg_modal_ID");
            if (swapMode !== 1) {
              show_addbutton_args_modal(modalId);
            }
          });
        });
        
        
        // Ajouter des couteurs d'vnements sur chaque modal pour la fermer en cliquant en dehors
        addbutton_args_modal_containers.forEach(function(modalContainer) {
          let modalId = modalContainer.getAttribute("id").split("-").pop();
        
          // Ajouter un vnement de clic  la div modal-container
          modalContainer.addEventListener("click", function(event) {
            if (event.target === modalContainer) {
              hide_addbutton_args_modal();
            }
          });
        });
        
        // Ajouter des couteurs d'vnements sur chaque bouton de fermeture
        addbutton_args_modal_close_buttons.forEach(function(close_button) {
          close_button.addEventListener("click", function() {
            hide_addbutton_args_modal();
          });
        });




        // Initialize a variable to keep track of the opened modal
        let is_editbutton_modal_opened = 0;
        
        // Select all buttons that have the class "edit-button"
        const open_modal_editbutton = document.querySelectorAll(".edit-button");
        
        // Select all modal containers
        const editbutton_modal_containers = document.querySelectorAll(".editbutton-modal-container");
        
        function show_editbutton_modal(modalId) {
          const modal = document.getElementById("edit-modal-container-" + modalId);
          if (modal) {
            modal.style.opacity = "100%";
            modal.style.display = "block";
            is_editbutton_modal_opened = 1;
          }
        }
        
        function hide_editbutton_modal(modalId) {
          console.log(modalId);
          const editbutton_modal = document.getElementById("edit-modal-container-" + modalId);
          if (editbutton_modal) {
            let intervalId = setInterval(function() {
              let currentOpacity = parseFloat(getComputedStyle(editbutton_modal).opacity);
              if (currentOpacity <= 0) {
                // L'animation est termine, cacher la modal
                clearInterval(intervalId);
                setTimeout(function() {
                  editbutton_modal.style.display = "none";
                }, 100); // Attendre avant de cacher la modal
                  return;
                }
                editbutton_modal.style.opacity = (currentOpacity - 3.5).toFixed(2);
              }, 10); // Rpter toutes les 0.01s (10ms)
            is_editbutton_modal_opened = 0;
          }
        }

        // Add event listeners to each button to open the corresponding modal
        open_modal_editbutton.forEach(function (button) {
          button.addEventListener("click", function () {
            if (is_editbutton_modal_opened === 0) {
              const modalId = button.getAttribute("edit_modal_id");
              show_editbutton_modal(modalId);
            }
          });
        });
        
        // Add event listeners to each modal container to close the modal when clicked outside
        editbutton_modal_containers.forEach(function (modalContainer) {
          const modalId = modalContainer.getAttribute("edit_modal_id");
        
          modalContainer.addEventListener("click", function (event) {
            if (event.target === modalContainer) {
              hide_editbutton_modal(modalId);
            }
          });
        });
        
        // Add event listeners to each close button
        const editbutton_modal_close_buttons = document.querySelectorAll(".editbutton-modal-close");
        editbutton_modal_close_buttons.forEach(function (close_button) {
          close_button.addEventListener("click", function () {
            const modalId = close_button.closest(".editbutton-modal-container").getAttribute("edit_modal_id");
            hide_editbutton_modal(modalId);
          });
        });
        







        // fullscreen
        
        const fullscreenBtn = document.querySelector('.fullscreen-btn');
        const zoomInBtn = document.querySelector('.zoom-in-btn');
        const zoomOutBtn = document.querySelector('.zoom-out-btn');
        const buttonsCenter = document.querySelector('.buttons-center');
        const shrinkBtn = document.querySelector('.shrink-btn');
        const expandBtn = document.querySelector('.expand-btn');
        const dezoomBtn = document.querySelector('.dezoom-btn');
        const zoomBtn = document.querySelector('.zoom-btn');
        fullscreenBtn.addEventListener('click', () => {
          if (document.fullscreenEnabled && swapMode === 0 ) {
            if (document.fullscreenElement) {
              document.exitFullscreen();
            } else {
              goFullscreen()
            }
            auto_resize();
          } else {
            console.log('Fullscreen mode not supported');
          }
        });


        try {
          let scale = 1;
          zoomInBtn.addEventListener('click', () => {
            if (swapMode !== 1) {
              scale += 0.1;
              document.documentElement.style.transform = `scale(${scale})`;
            }
          });
        } catch (error) {}

        try {
          zoomOutBtn.addEventListener('click', () => {
            if (swapMode !== 1) {
              scale -= 0.1;
              document.documentElement.style.transform = `scale(${scale})`;
            }
          });
        } catch (error) {}

        try {
          shrinkBtn.addEventListener('click', () => {
            if (swapMode !== 1) {
              const currentMargin = parseInt(getComputedStyle(buttonsCenter).marginLeft);
              buttonsCenter.style.marginLeft = `${currentMargin + 1}px`;
              buttonsCenter.style.marginRight = `${currentMargin + 1}px`;
            }
          });
        } catch (error) {}

        try {
          expandBtn.addEventListener('click', () => {
            if (swapMode !== 1) {
              const currentMargin = parseInt(getComputedStyle(buttonsCenter).marginLeft);
              buttonsCenter.style.marginLeft = `${currentMargin - 1}px`;
              buttonsCenter.style.marginRight = `${currentMargin - 1}px`;
            }
          });
        } catch (error) {}


        const cols = '{{config["front"]["width"]}}';
        const rows = '{{config["front"]["height"]}}';

        // Convertir les parties en nombres entiers
        const maxRows = parseInt(rows);
        const maxCols = parseInt(cols);

        // Rcuprer la taille d'une petite div
        const smallDiv = document.querySelector('.form-0');
        const smallDivStyles = getComputedStyle(smallDiv);
        const smallDivWidth = parseInt(smallDivStyles.width) + parseInt(smallDivStyles.paddingLeft) + parseInt(smallDivStyles.paddingRight);
        const smallDivHeight = parseInt(smallDivStyles.height) + parseInt(smallDivStyles.paddingTop) + parseInt(smallDivStyles.paddingBottom);

        // Calculer la limite de la grande div en fonction de la taille de la petite div
        const maxDivs = maxRows * maxCols;
        const maxWidth = maxCols * smallDivWidth + 10;
        const maxHeight = maxCols * smallDivHeight + 10;

        // Rcuprer la grande div et modifier sa largeur avec les marges
        const bigDivs = document.querySelectorAll('[id^="folder-"].buttons-center');
        bigDivs.forEach((bigDiv) => {
          bigDiv.style.maxWidth = `${maxWidth}px`;
          bigDiv.style.maxHeight = `${maxHeight}px`;
        });

        // REDIMENTIONNER LES DIVS POUR S'AJUSTER A LA TAILLE DE L'ECRAN

        var currentZoom = 1;

        try {
          dezoomBtn.addEventListener('click', () => {
            if (swapMode !== 1) {
              currentZoom = currentZoom - 0.05;
              let calcWidth = 100 / currentZoom;
              let calcHeight = 100 / currentZoom;
              document.body.style.transformOrigin = "left top";
              document.body.style.transform = "scale(" + currentZoom + ")";
              document.body.style.width = `${calcWidth}%`;
              document.body.style.height = `${calcHeight}%`;
            }
          });
        } catch (error) {}

        try {
          zoomBtn.addEventListener('click', () => {
            if (swapMode !== 1) {
              currentZoom = currentZoom + 0.05;
              let calcWidth = 100 / currentZoom;
              let calcHeight = 100 / currentZoom;
              document.body.style.transformOrigin = "left top";
              document.body.style.transform = "scale(" + currentZoom + ")";
              document.body.style.width = `${calcWidth}%`;
              document.body.style.height = `${calcHeight}%`;
            }
          });
        } catch (error) {}

        addEventListener("resize", (event) => {});
        onresize = (event) => {
          auto_resize();
        };

        /* Empcher le dfilement */
        document.addEventListener('touchmove', function(e) {
          if (!e.target.closest('.modal-content')) {
            e.preventDefault();
          }
        }, { passive: false }); // Empcher le dfilement sur les appareils mobiles

        // document.addEventListener('wheel', function(e) {
        //   e.preventDefault();
        // }); // Empcher le dfilement sur les ordinateurs





        // Get the button element in the form
        //onst button = form.querySelector('.button');

        //  let buttonClicked = false;
        //  // Dfinissez une fonction qui vrifie l'tat de l'vnement touchend
        //  function checkTouchEnd() {
        //    if (buttonClicked) {
        //      button.classList.add('activee');
        //      console.log("added")
        //    }
        //    else {
        //      button.classList.remove('activee');
        //      console.log("removed")
        //    }
        //  }
        //  // Utilisez setInterval pour excuter la fonction toutes les 0,1 secondes
        //  setInterval(checkTouchEnd, 300);


        // const print1 = document.getElementById('print1');
        // const print2 = document.getElementById('print2');

        //  // Add the mousedown event handler
        //  button.addEventListener('mousedown', function() {
        //    print2.innerHTML = 'mouseup: not active';
        //  });

        //  // Add the mouseup event handler
        //  button.addEventListener('mouseup', function() {
        //    print2.innerHTML = 'mouseup: active';
        //  });

        //  
        //  // Add the touchstart event handler
        //  button.addEventListener('touchstart', function() {
        //    buttonClicked = true;
        //    print1.innerHTML = 'touchstart: active';
        //  });

        //  // Add the touchend event handler
        //  button.addEventListener('touchend', function() {
        //    buttonClicked = false;
        //    print1.innerHTML = 'touchstart: not active';
        //  });

      });

    </script>
    
  </body>
</html>
